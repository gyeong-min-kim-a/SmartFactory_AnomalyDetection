# SmartFactory_AnomalyDetection
1. 개요
- 기간 : 2023.07 ~ 진행 
- 목표 
	- 경주의 실제 자동자 부품을 생산하는 센서데이터를 활용하여 불량품 탐지와 불량이 발생하는 원인, 시점 등을 파악하고자 함.
- 간단한 연구 설명
	- 해당 센서데이터는 주조 데이터이며, 공정의 초기에 해당함. 따라서 공정 초반에 불량품을 판단하여 재투입여부를 결정한다면 약 이틀이 걸리는 후공정에 투입되지 않고, 다시 주물을 녹여 다시 만들어볼 수 있음
	- 주물이 투입되는 시점 앞뒤로 5분(총 10분)간의 센서데이터의 변화를 통해서 주물의 완성도에 있어 중요한 시점을 알아낸다면, 해당 시점에 집중할 수 있게 됨.
- 역할 및 계획
	- 정상과 불량품 여부를 탐지하는 Anomaly Detection을 수행함.
	1. 데이터세트 탐색
	2. LSTM AE를 사용하여 재구성 차이를 통한 이상치 탐지 수행
	3. 2번의 결과 이상치 탐색이 되지 않아, 원인을 찾던 중 데이터세트의 이상함을 계속 보고 있음. 현재 데이터를 제공해주었던 업체와 확인 과정에 있음.

2. 데이터세트
	- 하나의 주조기에 대해서 여러곳에 온도와 압력센서가 부착되어 있어, 하나의 주물이 만들어지게 되면 약 10개 갸량의 센서에서 데이터가 수집됨.
	- 온도의 경우 일반적으로 온도가 연속적으로 증가, 감소해야하지만 해당 데이터의 경우 0아니면 특정 온도로 이루어져 있음.
	- 최종 사용 데이터셋의 크기(12580, 12)
	- 특징
		- 불량의 비율이 약 5:1수준으로 일반적인 불량품 데이터보다 상당히 높은 비율의 불량데이터가 포함되어있음
		- 하나의 센서를 뽑아 무작위로 100개의 샘플을 시각화함. 빨간색으로 표시된 경우 불량품을 의미함. 아래의 그림에서 알 수 있는 것은 주물 정상과 불량품 사이에 공통점이나 차이점을 발견할 수 없음. 샘플마다 제각각임. 
		- 또한 값이 약 2개만 존재하는 것처럼 0 혹은 특정값으로 이루어져 있음.
  - ![random_plots](https://github.com/gyeong-min-kim-a/SmartFactory_AnomalyDetection/assets/174190109/394c602e-2205-4da0-9ea2-27d7f8214231)

  - 이는 4개의 셈플에 대해서 모든 열(센서)를 표시함. 아래쪽에 위치하 두개의 그래프가 불량품에 대한 데이터임.
  - ![Pasted image 20240630222153](https://github.com/gyeong-min-kim-a/SmartFactory_AnomalyDetection/assets/174190109/4ca5969d-b349-47b2-b731-ef79deea3761)

3. LSTM AE(불량품 탐지)
	- Anomaly Detection에서 가장 흔하게 사용하는 방법은 크게 3가지임. 기계학습 방법, 재구성 오차를 이용하는 방법이 있음. 현재 데이터세트는 (샘플, 센서, time)으로 3차원의 데이터이기 때문에 특징 학습에 용이한 재구성 오차를 이용하여 분류하고자함. 
		- timestep가 601개이므로 RNN 보다 장단기의 의존 관계를 파악할 수 있는 LSTM을 사용함. 또한 AE를 사용하여 고차원의 데이터를 압축하고 다시 재구성함. 정상데이터로만 학습하 모델에 불량품 데이터가 입력되면 디코더를 거치며 재구성의 오차가 커짐을 이용함. 
	- 결과
		- 정상과 불량품 사이의 데이터의 오차율 범위가 크게 차이나지 않음. 이는 LSTM AE 적용 의도는 정상의 경우 재구성 오차가 거의 포함되면서, 불량품의 경우 재구성 오차를 포함하지 않는 오차 임계값을 찾으려함. 
			- 이유는 데이터 셋에서 찾아볼 수 있음. 양품과 불량품 사이의 차이가 눈으로 보았을 때 미묘할 수 있은, 정상적인 패턴이 어느정도인지 파악이 가능하여야 함. 하지만 이 데이터세트에서는 어떠한 패턴도 찾아볼 수 없었음.
   - 정상 데이터의 재구성 오차율 분포 시각화
   - ![Pasted image 20240630222327](https://github.com/gyeong-min-kim-a/SmartFactory_AnomalyDetection/assets/174190109/00cd28db-160c-433a-ab7b-bc833f8d31e1)
   - 불량품 데이터의 재구성 오차율 분포 시각화
   - ![Pasted image 20240630222408](https://github.com/gyeong-min-kim-a/SmartFactory_AnomalyDetection/assets/174190109/81565644-fb8d-4bc3-8d8a-52705e899a65)

4. 데이터 탐색 다시하기
	- 각 센서의 측정값 분포를 시각화한 결과, 센서별로 몰려있는 값이 존재함을 확인함
	- 또한 1_8을 제외하고, 양품과 불량품의 측정값이 비슷함을 볼 수 있음.
 - ![Pasted image 20240630223027](https://github.com/gyeong-min-kim-a/SmartFactory_AnomalyDetection/assets/174190109/9d3bbf16-e35b-4442-bf87-195e9e876171)

 - 	이는 시간별로 겹쳐서 양품과 불량품의 시간별 평균을 시각화함
		- 평균차이가 큰 구간이 존재함.
		- 같은 종류의 센서끼리 비슷한 흐름을 보임을 알 수 있음.
		- 하지만 측정값의 분포가 특정 값에 몰려있는 결과이기 때문에 아래 정규화를 적용한 후 비교 시도
   	- 시간별 평균 시각화
    - ![Pasted image 20240630223938](https://github.com/gyeong-min-kim-a/SmartFactory_AnomalyDetection/assets/174190109/6da3fccc-fd27-4f2d-a207-f5f3125d903e)
    - 정규화 후 평균을 비교한 결과 차이가 양품과 불량 사이 차이가 나는 부분이 비슷함을 확인함. 
	  - 시간별 정규화 후 평균 시각화
    - ![Pasted image 20240630224117](https://github.com/gyeong-min-kim-a/SmartFactory_AnomalyDetection/assets/174190109/cf77cd8a-0285-462a-955c-b4a1decaaa0c)
